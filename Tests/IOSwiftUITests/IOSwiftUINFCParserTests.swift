//
//  IOSwiftUINFCParserTests.swift
//  
//
//  Created by Adnan ilker Ozcan on 21.12.2022.
//

import XCTest
@testable import IOSwiftUISupportNFC
@testable import IOSwiftUIInfrastructure

final class IOSwiftUINFCParserTests: XCTestCase {
    
    func testComParser() throws {
        let comData = Data(fromHexString: "60185f0104303130375f36063034303030305c066175656b6c6f")
        
        let comModel = try IOISO7816DGComModel(data: comData)
        XCTAssertEqual(comModel.version, "0107")
        XCTAssertEqual(comModel.unicodeVersion, "040000")
        
        XCTAssertNotNil(comModel.dataGroups.first(where: { $0 == .dg1 }))
        XCTAssertNotNil(comModel.dataGroups.first(where: { $0 == .dg2 }))
        XCTAssertNotNil(comModel.dataGroups.first(where: { $0 == .dg5 }))
        XCTAssertNotNil(comModel.dataGroups.first(where: { $0 == .dg11 }))
        XCTAssertNotNil(comModel.dataGroups.first(where: { $0 == .dg12 }))
        XCTAssertNotNil(comModel.dataGroups.first(where: { $0 == .dg15 }))
    }
    
    func testDG1Parser() throws {
        // I<TURX98Y123456<12345678901<<<3201311F4201313TUR<<<<<<<<<<<4ABCDE<<FGHIJ<KLMNO<<<<<<<<<<<<
        let dg1Data = Data(fromHexString: "615D5F1F5A493C545552583938593132333435363C31323334353637383930313C3C3C3332303133313146343230313331335455523C3C3C3C3C3C3C3C3C3C3C3441424344453C3C464748494A3C4B4C4D4E4F3C3C3C3C3C3C3C3C3C3C3C3C")
        
        let dg1Model = try IOISO7816DG1Model(data: dg1Data)
        XCTAssertEqual(dg1Model.documentCode, "I")
        XCTAssertEqual(dg1Model.issuingState, "TUR")
        XCTAssertEqual(dg1Model.documentNumber, "X98Y12345")
        XCTAssertEqual(dg1Model.documentNumberCheckDigit, "6")
        XCTAssertEqual(dg1Model.optionalData1, "12345678901")
        XCTAssertEqual(dg1Model.dateOfBirth, "320131")
        XCTAssertEqual(dg1Model.sex, "F")
        XCTAssertEqual(dg1Model.dateOfExpiry, "420131")
        XCTAssertEqual(dg1Model.nationality, "TUR")
        XCTAssertEqual(dg1Model.optionalData2, "")
        XCTAssertEqual(dg1Model.surname, "ABCDE")
        XCTAssertEqual(dg1Model.name, "FGHIJ KLMNO")
        
    }
    
    func testDG2Parser() throws {
        let dg2Data = Data(fromHexString: "758211377F618211320201017F6082112AA12980020101810102820100830720210128111611840820210128202101288602000087020101880200085F2E8210FA46414300303130000000368C00010000367E00000000000000000000000000000000020000F00140010200000000FFD8FFE000104A46494600010201002400240000FFDB00430001010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101FFDB00430101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101FFC00011080036003603011100021101031101FFC4001F0000010501010101010100000000000000000102030405060708090A0BFFC400B5100002010303020403050504040000017D01020300041105122131410613516107227114328191A1082342B1C11552D1F02433627282090A161718191A25262728292A3435363738393A434445464748494A535455565758595A636465666768696A737475767778797A838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE1E2E3E4E5E6E7E8E9EAF1F2F3F4F5F6F7F8F9FAFFC4001F0100030101010101010101010000000000000102030405060708090A0BFFC400B51100020102040403040705040400010277000102031104052131061241510761711322328108144291A1B1C109233352F0156272D10A162434E125F11718191A262728292A35363738393A434445464748494A535455565758595A636465666768696A737475767778797A82838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE2E3E4E5E6E7E8E9EAF2F3F4F5F6F7F8F9FAFFDA000C03010002110311003F00FEA26DAD4151C0C027F4E3B76FC8D7D7CDE87E7B4AFA7AFF00C39BF6B67F2E719C80071CE7FCF639E0F06B96A49256EAFF00AFF33BA09DEFD3CF6DFA799AD159A8E40F7FC7EBC7F93F5AE6A8FDDF57AFC8E98EC4CD6639C8EB9EDF8639F6E7F5EB589A453BAE9D7E4519EC9403F2E7E5CFAF7F6E3D074FCB3404AF7D77B74317EC40165C77F4F4E871DB1EB8EF5AD4DA24BB9DAFC39B40BE20BA3D0FF645C0F4FF0097DB023D4638F4CD72D5578AF5FD19D186F8DFF81FE7138CB288328190783EE33CF5FA7F4AF72A6E785457BBF3D7FAF43A6B68B0A0639FF23F5FF13EB5C737793BF4D3E48EFA715A2EFABFBAE6BA4415791CF7EFFE79AE56DC9DDFC8DE36BEBB74FD07ED5F4FF3FE7FCE6836219220DF4EFF00E3FE7D681595EFF232E4B41BC9F739FF00391FAD0DBB5BA2D57F5F32546D2F2DD1D77806D80D72E4F7FECB9C73CFFCBDD8FF0087E9D2B1ABF0AF5FD19B508FEF1DBF91FF00E948F16D2AF830009F41DF20F1923F5EF8EB5F4D5697DD7F9AB7F5DCF96A351A5EB6B6CF77B7F5D8F41B299648D4839231CFF5FCFF000AF32A41C657B68FA9ECD19C6493F45E8EC705F18FE357C2FF00803E01D53E26FC61F19699E06F04E8E634BCD5F521733996E260ED058E9FA7D84179A9EABA84C91CB24765A6D95D5D98629E7F284104F247E563B1586CBE93AF8AAB1A549349369CA5293BDA14E114E7526ECF96108CA4D26ED64D9EB65B95E3F37C543059761A789C44D3972C5C610A704D2954AB56A4A14A8D28B6B9AA559C20AE9377693FCD1B8FF82EB7FC139348BAB75F14FC4DF1AF84348B9D50E903C4FAEFC2BF1BBE8915E1B5B9BC885C268BA5EB1ADC315C476972B14CFA284596278E7F276923C5C27146538DAB2A587A95A728479E4FD84D5A3CCA1CCE3FC4B73B51768369B4DA4B53EB31BE1EF126594235F174B0905526A14E2B1949B9CF9653E453D2927C9194973548A6A2ECDBB27FA6DF087E337C25F8FF00E06D2FE257C13F88BE13F89DE05D6157EC5E24F086AF6DAB58ACC628A6934FD41606FB5691AC5AA4F17DBF45D5ADEC757D3A4710DFD95BCC0C63DCA35E96220AA519C6A41F55BA7FCB28BB38C97DA8C92927A349E87C9E2F078AC0D6961F1742A50AB1FB3515B996CA5092BC67095BDD9C25284B78C9A3D33C9538C8FAF5FE5DAB4918C1734ADD17E8753E07842EB372401FF20D9863AFFCBCD97F2E7D6B29FC36DB5FD19AD35CB524BA72BB5FD51F31DB2881C2863819F5E4F6C8FF00F58AFB49A52BB6AEDFE5A1F0D4E5CBA5ECB4B236DFC4FA578674CBED73C43AA58E8FA2E916B2DF6A9AA6A57515A58D85A42A5E59EE6E266548A345C0CB364B1545058853E563E5430D87AB88C455A74285284AA55AB5671A74E9D38ABCA539CED18A5DDB3D8CAE96331B8CA181C161AB633178AA91A387C361E9CEAD7AD524D28C29D38294E727D1456DABD15CFE4CBFE0ACDFF0511F807FB4C7C4EF057C38F075E5EFC52F839E0D5BAD33C55A36AB727C39E11D57C4115DDC6A1A878AF4A38FED892EB4E16FA0E9965FDA76B6F797496DAA5AD86991DB6A0F71A8FE07C619E4F3BA94DE4D89AB86A38182AB43193A3371C5D6A95229AC3D26E337467463387B79462D39B70D1393FEB6F0D38521C2D1AEF89F01471789CCEAFD5F159753C44154C0E1A9519B5F5AC44615292C443153856FAB425522FD946351B9DA31FE77BF683F11681E2F5F11EABA2E9771A1784ACEF92EBC2FE1F967FED4D534AD364D663B9B1B2D575436D136AF7AB6F1CCD2CA5032DBAC764F3CEF13CF2F87904EBD0CCF0D073854AD88752189AB7E4A7513A53529429A6BD9A8B708A77D6779F2C744BEBF8AA961B119363671A5521470DEC6BE0E92F7EB53953AD4E54D4AA38DEA39724E728F4A6FD9734B56FF007DFF00E0DA0F80DFB56D87C67F883F18FC3BE29B8F0BFECA1A4A788FE1F7C56F0F6A17B1DD69FF0012FE22D8E8F6B3F85B49D0B4032BC961AD78265D66C3C477FE3236F6BE5E977937866DA7BD4D7F508AD3F50E1EA95F115AA57838AC3A5C951A69F3CDC55451B27F1454E32E6B7BB0F72FEF58FC278FFEA385C3D1C1D6837984A5ED687BAD3A3423374A751CDAF82A3A53A5ECD7C734EA357A699FDAD80064E73FD07D057D74BA1F95C1A8BBAD57F9FF00C13A9F0563FB5EE3FEC1D37E5F69B3C7F5AC6A7C2BD7F466F49F3546FF00BAEDE9747C96F37FA4E09C852401DFA73FAF7F7E7D47DEC69DE92DAED5B9BA797E07E752A96A96D747A7DCAFF99CDFC42F06E8BF13FC03E33F877AFA44DA478CFC39AA787AF1A7B486FA3806A36AF1437BF63B83E45D49617261BD8609711BCD6E8AE554E6BCACDB2AA79A65D8CCBEB5E34F1987A942524949D37522E31A91525CAE74E4E3523CCB979A2BE5EEF0FE7D89C833BCB33AC2D9D7CB31B87C65384A5282ABEC6A4652A13942D254EBC39A8D471F7B9272B1FCB1FC56FF0083797F692F1478DF55D4FE1EFC6AF83771E1F9754B8B8B28BC4579E30D275BD422BC613CD25ED8DB785355D3EDE53772CA4C075DB96DA9E7CD7F793CAE8FF89CBC38CFF2FC2D4A342794E363460A9E1653AB89C1C9D38A4A178C70B898D29285D38C67523EEDA2A2ADCBFD3F0F1BF84736CC296271B86E21CB5E2AACEB63E146860732A70AD51CE55396A4F1F819E2A32A967CD3A546A3E66E7CCE2D4BF9D7F129BF7D5E6F0EE836579AD3432EA569A55F68F6977AB2F89D74EBDBED2E4BC4696C6DDAC34F8EE6CEE121F3EDA08A2489A59652E8CF5F1DFD913CB9D4AD8AC4E19C215546B54954F61470F77077A6E5252ACE77D355526DF2AA6B447EAF85C662B892585C365393E6D5EB63B0B5B1580C3D0C1CF1D89C750C3BAF0AF5274F0D4EA2A10C27B0A8F13269D0C3C212AB52BF27BE7EC47FC113FF00E0A19ACFEC59FB4C7823F649F196A7A47893E187ED11E34D3740F893ADDC6A4654F879F1735E920F0CF8327D1F59691F4EBCD374996DF4CF0E78D6E8CC34EB96D5AE2E2DEF7C8F0759CBA8FDF70BE3A52957C47B1784CBF175A10C251A94FD8CA54A308A863AA52718CB0F2C4D59CFF7535CDF57542A5450A929423F9FF8DBC1397646B2ACA30D9C61F3FE25CA32875F8AB179757A38FCBB079DD6C5E2EA57E1AC066784AF89C26714726CAE965CB1198E125F5779D4F37C2616A6230B469622A7F7C135CC7170EC32074CFA0CFBFA1E335F7DF91FCC716D7A1A9E09D519F5EB9452368D2EE0F7CF1796639C71C66B2ABF0AF5FD19D18793751FF81FE713E4897515376EBDD8E09E32AC067A678EB938AFD22149AA6BF3E96F33F2C9D77ED5CBF0F55FF0752DADFE1CA86E983C9F5E9F53DF19EDDE97B2F4FC471AED4AEEFBFE1DBF43C4BF690F8B5A57C21F819F15BC7FAA6BB0682344F04EBD16977F34CD17FC549AAD8CBA4F85AD2DCA10ED77A8788AFF004CB3B558D8399E7420A0CBAF9B9D4A384CA730C537187B1C2579C24EF6F6BC8E3452F3954718A4B5BB5B9EEF0DD2A999F1064F818C255162730C353AB08F2FF03DB465889BBE8A30A2AA4E57BA518EA7F9CC78A3E1EF873C17AD6ADA33F8B6683556B6BE16CF61E4C30EABA6DC225C69D70ED3DD5B3CC6EED668D6FF004F8D24795D64910CB6F71184FE6F9E2ABCE2E51A2AA5384A1CEBE250927F12567EEDD73464FE1925B38A6FFB7B0D87A78495A38AAB86AD568D6A519D372A6E787AD070AB45CE128BE5A94E72A5569DF96AD3938CB9A12945799DADD69B6BAE68BA7C8F2DBF88B4FD462BC9750B69712C377697263B2814A436F2D9F913AB4F1B6D5B8DD2A9B908E59962AAC5430D88C45352587E5B454D4A0DB925394E2AEF5E5B6AB44E3686C8AA7F56AB89A3427284F11CCB9B91C26928B942319FBBD66A774D5F5BCB56CFF50FF82FF11355F19FC0FF00833E30F104D249AFF8ABE137C3BF12EB724AC4CAFAB6BBE0FD1F53D49E46CE5A46BCBA9CB3752C49EF5FAE612B7B4C0E1272D25570D87A936FF9A74A1296AFADF7EFB9FCB19961D50CD331C3D2FE1D1C7E328D349592852C4548C1792E58A3DEBE18EAFE7788AED3272345B86EBDBEDDA70E80F1D7F9D455A91F853D6F7F959F5EBF20C3D392937FDD7DBBAF99E3EBF0A3C6666329D43C3DF338207DB752382781FF0030718C7A8E7F3E3F51798E063151F6788FFC029EDDBF8C7E50B2AC7F3733A986D5DEDCF55F5FFAF3FD791A29F0A3C5FB99CDFF0087FD41179A9672413939D2BAD4BCCB04E36E4C42F4A74BFF00977737594E3536DCF0DD2DEFD4E97D1FEE3CBA1FCD37FC1527E1CFED7DFB4AFC667F821E14F15FC2FF00057C1BF861ADE9F75158CFE30F1AA6AFE35F15C76B6D3CFAF789EC2C3E1F4D649068CD7335A785F4D8F54BE86DB6CFAADDB3DDEA296DA57E73C639A57CC9CF03452A582A1BC26ED3AF57962DCEAA8A69461771A705292DE6DF334A1FB2F8759560B25853CCF10A55F33C5592AB08C654F0B45CA56A7439E506E5351E6AD51C60DFBB4A2B922E553F233E3BFF00C12A3F684F14F8DB51B83E30F83C62D3BC4F2E9962F278AFC716864D2F4D7482DCCB696BF0CE45B69FEC9691402186F668E1565104F18B75337E6581CBB1587AB8B942AE1DC6A51949C650936A7EF46294B6E5BC949FB97BA69A92936BF71CCF3FCBF13470146787C629C71508A9C674E2B9547DAB6E2A57726A2E1672B5A574E2E3697132FF00C11AFF00687D4AEFC47E2BB5F1D7C134BAD034FB0D7A58AE7C47E3D11DC5BDDF88BC39E1F874FB64B6F8731C76C6C935D59A3B8956E9675B1F29EDD1AF0CB6BD387C3E2F1142B616AD4A34E8AA52E4549394B9E2D2939CE70BB8CDB6ED17171BE8DDB5E0C666B9760F1584C751C3E26AE26A62234EACAB49538FB2953A938FB3853ACE1ED292828C1CE324F56EDCDEEFF69FFB08F82BE355E7EC9BF06F49F88BACF83B53F19F83BC2B1782356D5F4BD5B5BBBB2D5A0F08DDDCE81A2DFACD79E1AD36E9EE67D02C74BFED069AD11DB50174C24994ACD27D264F56ACB2DC353ACD39D08BA178B6D38D19385377924EFECD479AEBE2E6E87E59C4F87C3C73DCC2AE114A34B1138E2942A251709E2611AB5A36839AE5F6D2A8E3697C0E2AC9A3EF6F85FE04F16D8F892F26BBBAD09A23A2DCC204177A83C9E67DBB4D652449A644A102A30277139DBF2F523B1EECF129465777E5BDBA376DD79200FFD9")
        
        let dg2Model = try IOISO7816DG2Model(data: dg2Data)
        XCTAssertEqual(dg2Model.numberOfBiometricInformation, 1)
        XCTAssertEqual(dg2Model.biometricDatas[0].header.headerVersion, "0101")
        XCTAssertEqual(dg2Model.biometricDatas[0].header.biometricType, "02")
        XCTAssertEqual(dg2Model.biometricDatas[0].header.biometricSubType, "00")
        XCTAssertEqual(dg2Model.biometricDatas[0].header.creationDate, "20210128111611")
        XCTAssertEqual(dg2Model.biometricDatas[0].header.creationDate2, "2021012820210128")
        XCTAssertEqual(dg2Model.biometricDatas[0].header.validityPeriod, "")
        XCTAssertEqual(dg2Model.biometricDatas[0].header.creator, "0000")
        XCTAssertEqual(dg2Model.biometricDatas[0].header.formatOwner, "0101")
        XCTAssertEqual(dg2Model.biometricDatas[0].header.formatType, "0008")
        XCTAssertNotNil(dg2Model.biometricDatas[0].image)
    }
}
